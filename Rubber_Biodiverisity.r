#Author: Zhuangfang Yi, contact:zfyi@mortonarb.org; or find me at:http://geoyi.org
#Creat R script for calculate biodiversity counts
#First the country code for 8 countries in Asia
setwd("C:/GIS/Biodiversity")
list.files("C:/GIS/Biodiversity")

getwd()

#Read Biodiversity data that includes Mammals, reptiles and amphibians
Mammals <- read.table('Mammals.csv',header = TRUE, sep = ",", quote = "",row.names = NULL, stringsAsFactors = FALSE)
Amphibians <- read.table('Amphibians.csv',header = TRUE, sep = ",", quote = "",row.names = NULL, stringsAsFactors = FALSE)
Reptiles <- read.table('Reptiles.csv',header = TRUE, sep = ",", quote = "",row.names = NULL, stringsAsFactors = FALSE)

# Rubber data
Rubber <- read.table('Rubber.csv',header = TRUE, sep = ",", quote = "",row.names = NULL, stringsAsFactors = FALSE)

#Other socioEconomic datasets that include Market Accessibility, other risks and Rubber growing suitability 
MarketAcc50k <- read.table('Acc_50k_Counties.csv',header = TRUE, sep = ",")
Suitablility <- read.table('Suitability100_Counties.csv',header = TRUE, sep = ",")
MinWageYield <- read.table('MinimumWageAndYield.csv',header = TRUE, sep = ",")
RubberMiniCost <- read.table('Rubber costs and prices in Asia.csv',header = TRUE, sep = ",")


str(Mammals)
summary(Mammals)
summary(Amphibians)
summary(Reptiles)
summary(Rubber)

#loading dplyr package
library(stats)
library(dplyr)
library(ggplot2)

MergeAll <- function(x,y) {
  merge(x,y, by = "FID")
}

#run the defined merge function
Test1 <- MergeAll(Rubber, Mammals) 
Test2 <- MergeAll(Reptiles, Amphibians)
test3 <- MergeAll(MarketAcc50k, Suitablility)


BioRubberCounties <- MergeAll(Test1, Test2) 

#%>% select(FID,Rubber.in.Ha, Mammals.counts,Reptiles.counts,Amphibians)

BioRubberCounties<- mutate(BioRubberCounties, Biodiversity = rowSums(BioRubberCounties[7:9],na.rm=TRUE))

BioRubberCounties <- MergeAll(BioRubberCounties, test3)

#BioRubberCounties <- merge(x = BioRubberCounties, y = MinWageYield, by = "NAME_0", all = TRUE)
RubberMiniCost <- RubberMiniCost %>% select(Countries, RPrice)

BioRubberCounties <- merge(x= BioRubberCounties, y= RubberMiniCost, by.x= "NAME_0", by.y = "Countries", All = TRUE)
#delete last row of my data
n<-dim(BioRubberCounties)[1]
BioRubberCounties <-BioRubberCounties[1:(n-2),]

#define a function of normalization between 0 to 1. 

Normalization <- function(x){
  (x - min(x))/(max(x)-min(x))
}

#Normalize biodiversity loss indicator
NorBioD <- Normalization(BioRubberCounties$Biodiversity)

#Normalize rubber cultivation area
NorRubber <- Normalization(BioRubberCounties$Rubber.in.Ha)


BioRubberCounties <- BioRubberCounties %>% mutate(NorBioD) %>% mutate(NorRubber)

#Export the dataset 'BioRubberCounties'

write.table(BioRubberCounties, file = "BioRubberCounties.csv", sep = ',')

