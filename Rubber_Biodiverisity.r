#Author: Zhuangfang Yi, contact:zfyi@mortonarb.org; or find me at:http://geoyi.org
#Creat R script for calculate biodiversity counts
#First the country code for 8 countries in Asia
setwd("C:/GIS/Biodiversity")
list.files("C:/GIS/Biodiversity")

getwd()

#Read Biodiversity data that includes Mammals, reptiles and amphibians
Mammals <- read.table('Mammals.csv',header = TRUE, sep = ",", quote = "",row.names = NULL, stringsAsFactors = FALSE)
Amphibians <- read.table('Amphibians.csv',header = TRUE, sep = ",", quote = "",row.names = NULL, stringsAsFactors = FALSE)
Reptiles <- read.table('Reptiles.csv',header = TRUE, sep = ",", quote = "",row.names = NULL, stringsAsFactors = FALSE)

# Rubber data
Rubber <- read.table('Rubber.csv',header = TRUE, sep = ",", quote = "",row.names = NULL, stringsAsFactors = FALSE)

#Other socioEconomic datasets that include Market Accessibility, other risks and Rubber growing suitability 
MarketAcc50k <- read.table('Acc_50k_Counties.csv',header = TRUE, sep = ",")
Suitablility <- read.table('Suitability100_Counties.csv',header = TRUE, sep = ",")
MinWageYield <- read.table('MinimumWageAndYield.csv',header = TRUE, sep = ",")
RubberMiniCost <- read.table('Rubber costs and prices in Asia.csv',header = TRUE, sep = ",")


str(Mammals)
summary(Mammals)
summary(Amphibians)
summary(Reptiles)
summary(Rubber)

#loading dplyr package
library(stats)
library(dplyr)
library(survival)
library(Formula)
library(Hmisc)
library(ggplot2)

MergeAll <- function(x,y) {
  merge(x,y, by = "FID")
}

#run the defined merge function
Test1 <- MergeAll(Rubber, Mammals) 
Test2 <- MergeAll(Reptiles, Amphibians)
test3 <- MergeAll(MarketAcc50k, Suitablility)


BioRubberCounties <- MergeAll(Test1, Test2) 

#%>% select(FID,Rubber.in.Ha, Mammals.counts,Reptiles.counts,Amphibians)

BioRubberCounties<- mutate(BioRubberCounties, Biodiversity = rowSums(BioRubberCounties[7:9],na.rm=TRUE))

BioRubberCounties <- MergeAll(BioRubberCounties, test3)

#define a function of normalization between 0 to 1. 

Normalization <- function(x){
  (x - min(x))/(max(x)-min(x))
}

#Normalize biodiversity loss indicator
NorBioD <- Normalization(BioRubberCounties$Biodiversity)

#Normalize rubber cultivation area
NorRubber <- Normalization(BioRubberCounties$Rubber.in.Ha)

#Normalize the average suitability
NorSuitability <- 1- Normalization(BioRubberCounties$Avg_Suitability)

#Normalize the average accessibility to the market
NorAcc.50k <- Normalization(BioRubberCounties$Acc.Mean)

NorBioRubber <- BioRubberCounties %>% select(FID, ISO, NAME_0) %>% 
  mutate(NorBioD) %>% 
  mutate(NorRubber) %>%ã€€
  mutate(NorSuitability) %>%
  mutate(NorAcc.50k)

#write a classification function 
Group5 <- function(x){
  as.numeric(cut2(x, g=5))
}

# value classification 
NorBioRubber$BioClass <- Group5(NorBioRubber$NorBioD)
NorBioRubber$RubberClass <- Group5(NorBioRubber$NorRubber)
NorBioRubber$SuitaClass <- Group5(NorBioRubber$NorSuitability)
NorBioRubber$ACC50kClass <- Group5(NorBioRubber$NorAcc.50k)

#Export the dataset 'BioRubberCounties'

write.table(BioRubberCounties, file = "BioRubberCounties.csv", sep = ',')
write.table(NorBioRubber, file = "Normolized BioRubber for Classification", sep = ',')

#plot the classes. 
